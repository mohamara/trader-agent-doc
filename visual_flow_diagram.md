# نمودار بصری فرآیند آنالیز

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           PANEL (Frontend)                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  📊 فرم آنالیز                    📝 ورودی کاربر                          │
│  ┌─────────────────┐            ┌─────────────────────────────────┐        │
│  │ داده OHLC       │            │ • strategy_name: "orderblock"   │        │
│  │ استراتژی        │            │ • strategy_mode: "bullish"      │        │
│  │ حالت تحلیل      │            │ • settings: {...}              │        │
│  │ تنظیمات         │            │ • data: [{...}, {...}, ...]     │        │
│  └─────────────────┘            └─────────────────────────────────┘        │
│           │                                    │                           │
│           ▼                                    ▼                           │
│  🔗 handleAnalysisSubmit()           📦 ساخت requestData                  │
│           │                                    │                           │
│           └──────────────┬─────────────────────┘                           │
│                          ▼                                                 │
│                 🌐 makeAPIRequest("/analyze", "POST")                      │
│                          │                                                 │
└──────────────────────────┼─────────────────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                        API SERVICE (Backend)                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  📥 /analyze endpoint                                                       │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ 📦 دریافت JSON payload                                              │   │
│  │ 🔍 استخراج پارامترها:                                               │   │
│  │    • data_records                                                   │   │
│  │    • strategy_name                                                  │   │
│  │    • strategy_mode                                                  │   │
│  │    • settings                                                       │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                          │                                                 │
│                          ▼                                                 │
│  📚 Strategy Registry                                                      │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ 🔍 get_strategy_manifest(strategy_name)                            │   │
│  │ 📦 load_strategy_from_manifest(manifest)                           │   │
│  │ ⚙️ ایجاد instance استراتژی                                        │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                          │                                                 │
│                          ▼                                                 │
│  📊 پردازش داده‌ها                                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ 🔄 تبدیل به DataFrame                                              │   │
│  │ 🧹 پیش‌پردازش:                                                     │   │
│  │    • اضافه کردن volume                                             │   │
│  │    • تبدیل تاریخ                                                   │   │
│  │    • مرتب‌سازی                                                     │   │
│  │ ✅ اعتبارسنجی داده‌ها                                              │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                          │                                                 │
│                          ▼                                                 │
│  🎯 اجرای تحلیل استراتژی                                                   │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ strategy.analyze(df, mode, settings)                               │   │
│  │   │                                                                │   │
│  │   ├─ 🔍 detect_order_blocks()                                     │   │
│  │   │   │                                                            │   │
│  │   │   ├─ 📈 detect_moves()                                        │   │
│  │   │   │   • تشخیص حرکت‌های قیمت                                   │   │
│  │   │   │   • محاسبه قدرت حرکت                                      │   │
│  │   │   │                                                            │   │
│  │   │   ├─ 📊 برای هر حرکت:                                         │   │
│  │   │   │   ├─ 🔍 analyze_candle()                                  │   │
│  │   │   │   │   • نوع شمع (صعودی/نزولی/دوجی)                       │   │
│  │   │   │   │   • اندازه بدنه                                       │   │
│  │   │   │   │   • نسبت فتیله                                        │   │
│  │   │   │   │                                                        │   │
│  │   │   │   ├─ 📊 analyze_volume()                                  │   │
│  │   │   │   │   • محاسبه volume_score                               │   │
│  │   │   │   │   • تایید حجم                                         │   │
│  │   │   │   │                                                        │   │
│  │   │   │   └─ 💪 calculate_strength()                              │   │
│  │   │   │       • price_change_score                                │   │
│  │   │   │       • consistency_score                                 │   │
│  │   │   │       • volume_score                                      │   │
│  │   │   │       • body_ratio                                        │   │
│  │   │   │                                                            │   │
│  │   │   └─ 🔧 فیلتر کردن:                                           │   │
│  │   │       • حذف order blocks همپوشان                              │   │
│  │   │       • فیلتر بر اساس قدرت                                    │   │
│  │   │       • محدودیت تعداد                                         │   │
│  │   │                                                                │   │
│  │   └─ 📋 ساخت OrderBlockResult                                     │   │
│  │       • bullish_blocks: [...]                                     │   │
│  │       • bearish_blocks: [...]                                     │   │
│  │       • total_blocks: عدد                                         │   │
│  │       • strong_blocks: عدد                                        │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                          │                                                 │
│                          ▼                                                 │
│  📤 ساخت پاسخ نهایی                                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ {                                                                   │   │
│  │   "status": "success",                                             │   │
│  │   "strategy": {                                                    │   │
│  │     "name": "OrderBlock Strategy",                                 │   │
│  │     "version": "1.0.0",                                            │   │
│  │     "mode": "bullish"                                              │   │
│  │   },                                                               │   │
│  │   "analysis": {                                                    │   │
│  │     "bullish_blocks": [...],                                       │   │
│  │     "bearish_blocks": [...],                                       │   │
│  │     "total_blocks": 15,                                            │   │
│  │     "strong_blocks": 8                                             │   │
│  │   },                                                               │   │
│  │   "timestamp": "2024-01-15T10:30:00Z"                             │   │
│  │ }                                                                   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                          │                                                 │
└──────────────────────────┼─────────────────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           PANEL (Frontend)                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  📱 دریافت پاسخ                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ 📥 دریافت JSON Response                                            │   │
│  │ 🎨 updateAnalysisResults(result)                                   │   │
│  │ 📊 نمایش نتایج در UI:                                              │   │
│  │    • تعداد order blocks                                            │   │
│  │    • قدرت‌ها                                                        │   │
│  │    • آمار کلی                                                       │   │
│  │ 🔘 فعال کردن دکمه‌های عملیات:                                      │   │
│  │    • دانلود نتایج                                                   │   │
│  │    • ایجاد نمودار                                                   │   │
│  │    • ذخیره تنظیمات                                                  │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## خلاصه مراحل کلیدی:

### 🔄 مرحله 1: ورودی
- کاربر داده‌ها و تنظیمات را در پنل وارد می‌کند
- فرم ارسال می‌شود

### 🔄 مرحله 2: پردازش API
- API درخواست را دریافت می‌کند
- استراتژی بارگذاری می‌شود
- داده‌ها پردازش می‌شوند

### 🔄 مرحله 3: تحلیل
- حرکت‌های قیمت تشخیص داده می‌شوند
- برای هر حرکت، order blocks یافت می‌شوند
- قدرت هر order block محاسبه می‌شود

### 🔄 مرحله 4: خروجی
- نتایج فیلتر و مرتب می‌شوند
- پاسخ JSON ساخته می‌شود
- نتایج در پنل نمایش داده می‌شوند

## متغیرهای کلیدی:

| مرحله | متغیرهای ورودی | متغیرهای خروجی |
|-------|----------------|----------------|
| پنل | `data`, `strategy_name`, `strategy_mode`, `settings` | `requestData` |
| API | `payload` | `strategy`, `df` |
| تحلیل | `df`, `strategy`, `mode`, `settings` | `OrderBlockResult` |
| خروجی | `OrderBlockResult` | `JSON Response` | 